{% macro redirect(aid) %}
/redirect/{{ aid }}
{% endmacro %}

{% macro button(service, arg, text=None) %}
  {% if service=="source" %}
  <a class="about_source button" target="_blank" href="{{ arg }}">Source</a>
  {% elif service=="share" %}
  <a class="about_share button" target="_blank" href="/share/{{ arg }}">Share</a>
  {% endif %}
{% endmacro %}

{% macro keyword(key, rated=false) %}
    <a class="button" href="/key/id/{{ key.ID }}">{{ key.word }}</a>
{% endmacro %}

{% macro article_read(art) %}
        <div id="aid{{art.ID}}" class="issue1">
                <h2 class="issue_head" title="{{ art.title }}">{{ art.title }}</h2>
                {% if art.image.filename %}
                  <div class="image"><img src="{{ art.image.filename }}" alt=""/></div>
                {% endif %}
                <div class="issue_content">{{ art.content|safe }}</div>
                <div class="small">
                    <span class="time">{{ art.datestr }}</span>
                    <span class="keywords">
                        {% for key in art.keywords %}
                          {{ keyword(key) }}
                        {% endfor %}
                    </span>
                    <span>
                        {{ button("source", redirect(art.ID)) }}
                        {{ button("share", art.id, text=art.title) }}
                    </span>
                </div>
            </div>
{% endmacro %}
<!DOCTYPE html>
<html>
  <head>
    <title>Anchorbot {{ title }} {{mode}}</title>
    <link type="text/css" rel="stylesheet" href="{{ style }}">
    <script type="text/javascript" src="{{ url_for('static', filename='jquery.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='anim.js') }}"></script>
    {% if mode=="gallery" %}
    <script type="text/javascript" src="{{ url_for('static', filename='gallery.js') }}"></script>
    {% elif mode=="key" %}
    <script type="text/javascript" src="{{ url_for('static', filename='key.js') }}"></script>
    {% elif mode=="feed" %}
    <script type="text/javascript" src="{{ url_for('static', filename='feed.js') }}"></script>
    {% endif %}
  </head>
  <body>
    <div id="header">
      <a class="title" href="/">AnchorBot</a>
      <a class="menu" id="feeds" href="#">Feeds</a>
      <a class="menu" id="keywords" href="#">Keys</a>
      <a class="menu" href="/quit" title="Shuts down this server">Quit</a>
    </div>
    <div id="popup">
        <div id="popup_content"></div>
    </div>
    <div id="container">
      {% if mode in ["key", "feed"] %}
      <h1 title="{{ data.ID }}" id="keyword">{{ data.word }}</h1>
      <div id="content">
      </div>
      {% else %}
      <div class="content">
      </div>
      {% endif %}
    </div>
  </body>
</html>
